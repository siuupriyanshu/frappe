{% extends "templates/pages/base.html" %}

{% block page_content %}
    <!-- Blog Start -->
    <div class="container py-5">
        <div class="row g-5">
            <div class="col-lg-8">
                {% if blog %}
                <div class="mb-5">
                    <img class="img-fluid w-100 rounded mb-5" src="/assets/hospital/hospital/img/blog-2.jpg" alt="">
                    <h1 class="mb-4">{{ blog.title }}</h1>
                    <p>{{ blog.description or "Blog details will be available soon." }}</p>
                    <div class="d-flex justify-content-between bg-light rounded p-4 mt-4 mb-4">
                        <div class="d-flex align-items-center">
                            <img class="rounded-circle me-2" src="/assets/hospital/hospital/img/user.jpg" width="40" height="40" alt="">
                            <span>{{ blog.author or "Admin" }}</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="ms-3"><i class="far fa-eye text-primary me-1"></i>{{ blog.views or "0" }}</span>
                            <span class="ms-3"><i class="far fa-comment text-primary me-1"></i>{{ comment_count }}</span>
                        </div>
                    </div>
                </div>

                <div class="mb-5">
                    <h4 class="d-inline-block text-primary text-uppercase border-bottom border-5 mb-4">{{ comment_count }} Comments</h4>
                    {% if blog_comments %}
                        {% for comment in blog_comments %}
                        <div class="d-flex mb-4">
                            <img src="/assets/hospital/hospital/img/user.jpg" class="img-fluid rounded-circle" style="width: 45px; height: 45px;">
                            <div class="ps-3">
                                <h6>{{ comment.commenter_name or "Anonymous" }} <small><i>{{ frappe.utils.format_datetime(comment.creation, "dd MMM yyyy") }}</i></small></h6>
                                <p>{{ comment.comment_text }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="m-0">No comments yet. Be the first to comment.</p>
                    {% endif %}
                </div>

                <div class="bg-light rounded p-5">
                    <h4 class="d-inline-block text-primary text-uppercase border-bottom border-5 border-white mb-4">Leave a comment</h4>
                    {% if comment_success %}
                    <div class="alert alert-success" role="alert">{{ comment_success }}</div>
                    {% endif %}
                    {% if comment_error %}
                    <div class="alert alert-danger" role="alert">{{ comment_error }}</div>
                    {% endif %}
                    <form method="post" action="/detail?blog={{ blog.name }}">
                        <input type="hidden" name="csrf_token" value="{{ frappe.session.csrf_token }}">
                        <input type="hidden" name="add_comment" value="1">
                        <input type="hidden" name="blog_name" value="{{ blog.name }}">
                        <div class="row g-3">
                            <div class="col-12">
                                <input type="text" name="commenter_name" class="form-control bg-white border-0" placeholder="Your Name" style="height: 55px;" required>
                            </div>
                            <div class="col-12">
                                <textarea name="comment_text" class="form-control bg-white border-0" rows="5" placeholder="Comment" required></textarea>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary w-100 py-3" type="submit">Leave Your Comment</button>
                            </div>
                        </div>
                    </form>
                </div>
                {% else %}
                <div class="bg-light rounded text-center p-5">
                    <h4 class="mb-3">No blog detail found</h4>
                    <p class="m-0">Please select a blog post from the blog page.</p>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar Start -->
            <div class="col-lg-4">
                <!-- Category Start -->
                <div class="mb-5">
                    <h4 class="d-inline-block text-primary text-uppercase border-bottom border-5 mb-4">Categories</h4>
                    <div class="d-flex flex-column justify-content-start">
                        {% if categories %}
                            {% for category in categories %}
                            <span class="h5 bg-light rounded py-2 px-3 mb-2"><i class="fa fa-angle-right me-2"></i>{{ category.category_name or category.name }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="h5 bg-light rounded py-2 px-3 mb-2">No categories available</span>
                        {% endif %}
                    </div>
                </div>
                <!-- Category End -->

                <!-- Recent Post Start -->
                <div class="mb-5">
                    <h4 class="d-inline-block text-primary text-uppercase border-bottom border-5 mb-4">Recent Post</h4>
                    {% if recent_posts %}
                        {% for post in recent_posts %}
                        <div class="d-flex rounded overflow-hidden mb-3">
                            <img class="img-fluid" src="/assets/hospital/hospital/img/blog-1.jpg" style="width: 100px; height: 100px; object-fit: cover;" alt="">
                            <a href="/detail?blog={{ post.name }}" class="h5 d-flex align-items-center bg-light px-3 mb-0">{{ post.title }}</a>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="m-0">No recent posts available.</p>
                    {% endif %}
                </div>
                <!-- Recent Post End -->
            </div>
            <!-- Sidebar End -->
        </div>
    </div>
    <!-- Blog End -->
{% endblock %}
